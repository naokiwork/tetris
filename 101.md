# 改善点リスト 101

このドキュメントには、テトリスアプリケーションの修正案、改善案、機能改善、バグ修正をまとめています。

## 📝 修正案（20個）

### 1. ピース回転時の視覚的フィードバック強化
**場所**: `src/game.ts:195`
- ピース回転時に視覚的フィードバックが限定的
- **修正**: ピース回転時に一瞬光るエフェクトを追加し、回転が成功したことを明確に示す。

### 2. ハードドロップ時のエフェクト強化
**場所**: `src/game.ts:145`
- ハードドロップ時に視覚的フィードバックが不足
- **修正**: ハードドロップ時に軌跡を表示するエフェクトを追加。落下距離に応じた視覚効果を実装。

### 3. ピースの影の強化
**場所**: `src/renderer.ts:246`
- ピースの影が控えめで立体感が不足
- **修正**: ピースの影をより強調し、立体感を向上させる。グラデーション効果を追加。

### 4. ボードの境界線のアニメーション
**場所**: `src/renderer.ts:110`
- ボードの境界線が静的なまま
- **修正**: ボードの境界線が脈動するようなアニメーションを追加。ゲームの緊張感を高める。

### 5. スコア倍率表示
**場所**: `src/renderer.ts:300`
- 現在のスコア倍率が表示されない
- **修正**: 現在のレベルに応じたスコア倍率を表示するインジケーターを追加。

### 6. ゲーム速度の視覚的インジケーター改善
**場所**: `src/renderer.ts:353`
- ゲーム速度のインジケーターが小さい
- **修正**: ゲーム速度をより分かりやすく表示する大きなインジケーターを追加。

### 7. ピースの回転可能位置の表示
**場所**: `src/game.ts:195`
- ピースが回転できる位置が分からない
- **修正**: ピースが回転できる位置をハイライト表示する機能を追加。

### 8. ピース固定時の音響フィードバック
**場所**: `src/game.ts:243`
- ピース固定時に視覚的フィードバックはあるが、音響フィードバックがない
- **修正**: ピース固定時に短い音を再生する機能を追加。音量は設定で調整可能。

### 9. ライン消去時のエフェクト強化
**場所**: `src/renderer.ts:348`
- ライン消去時のエフェクトが単純
- **修正**: ライン消去時にブロックが上に飛び散るようなパーティクルエフェクトを追加。

### 10. レベルアップ時の音響通知
**場所**: `src/score.ts:20`
- レベルアップ時に視覚的通知はあるが、音響通知がない
- **修正**: レベルアップ時に特別な音を再生する機能を追加。

### 11. ゲーム開始時のカウントダウン音
**場所**: `src/main.ts:97`
- カウントダウン時に音がない
- **修正**: カウントダウン時に各数字ごとに音を再生する機能を追加。

### 12. スコア表示のアニメーション
**場所**: `src/renderer.ts:300`
- スコアが更新されても静的に表示される
- **修正**: スコアが更新された時に数字がカウントアップするアニメーションを追加。

### 13. コンボ表示の強化
**場所**: `src/renderer.ts:529`
- コンボ表示が基本的なもののみ
- **修正**: コンボ数に応じた視覚効果を強化し、連続コンボ時の特別なエフェクトを追加。

### 14. テトリスエフェクトの強化
**場所**: `src/renderer.ts:518`
- テトリスエフェクトが基本的なもののみ
- **修正**: テトリス時に画面全体が光る特別なエフェクトを強化し、パーティクルエフェクトを追加。

### 15. ピースの予測位置の強調改善
**場所**: `src/renderer.ts:185`
- ゴーストピースが改善されたが、さらに強調できる
- **修正**: ゴーストピースをより目立つ色やアニメーションで強調する。透明度のアニメーションを追加。

### 16. 一時停止中のUI改善強化
**場所**: `src/renderer.ts:550`
- 一時停止中のUIが基本的なもののみ
- **修正**: 一時停止中にゲームボード全体を半透明のオーバーレイで覆い、「PAUSED」のテキストをより目立つように表示。

### 17. キーリピートのカスタマイズ性向上
**場所**: `src/input.ts:11`
- キーリピートの遅延と間隔が固定値
- **修正**: 設定画面でキーリピートの遅延（REPEAT_DELAY）と間隔（REPEAT_INTERVAL）をユーザーが調整できるようにする。

### 18. ゲームオーバー時のアニメーション強化
**場所**: `src/main.ts:114`
- ゲームオーバー時の視覚効果がシンプル
- **修正**: ゲームオーバー時にボード全体が暗転したり、固定されたブロックが崩れるようなアニメーションを追加。

### 19. レベル表示のアニメーション
**場所**: `src/renderer.ts:300`
- レベルが更新されても静的に表示される
- **修正**: レベルが更新された時に数字がカウントアップするアニメーションを追加。

### 20. ライン数表示のアニメーション
**場所**: `src/renderer.ts:300`
- ライン数が更新されても静的に表示される
- **修正**: ライン数が更新された時に数字がカウントアップするアニメーションを追加。

## 💡 改善案（20個）

### 21. ゲーム設定のUI改善
**場所**: `新規実装`
- 設定画面が存在しない
- **修正**: 設定画面を追加し、音量、キー配置、描画品質などを視覚的に設定できるようにする。

### 22. カスタムコントロール設定のUI
**場所**: `src/input.ts:52`
- キー配置のカスタマイズがUIからできない
- **修正**: 設定画面で各操作に割り当てるキーを視覚的に設定できるUIを追加。

### 23. ゲーム履歴の詳細表示UI
**場所**: `src/main.ts:200`
- 過去のゲーム結果の詳細が表示されない
- **修正**: 各ゲームの詳細（スコア、レベル、ライン数、プレイ時間、日時）を表示する履歴画面を追加。

### 24. パフォーマンス統計の表示UI
**場所**: `src/main.ts:150`
- パフォーマンスの詳細統計がUIに表示されない
- **修正**: 平均FPS、最低FPS、フレームドロップ回数などのパフォーマンス統計を表示するUIを追加。

### 25. エクスポート/インポート機能のUI
**場所**: `新規実装`
- データのバックアップ機能がUIから利用できない
- **修正**: 統計データとランキングをJSON形式でエクスポート/インポートできるUIを追加。

### 26. 難易度選択のUI
**場所**: `src/game.ts:1`
- 難易度選択がUIからできない
- **修正**: ゲーム開始前に難易度を選択できるUIを追加（イージー、ノーマル、ハード、エキスパート）。

### 27. カスタムゲームモードのUI
**場所**: `src/game.ts:1`
- ゲームモード選択がUIからできない
- **修正**: スプリント（40ライン）、マラソン（200ライン）、ウルトラ（無制限）などのゲームモードを選択できるUIを追加。

### 28. ピースのプレビュー拡張のUI
**場所**: `src/renderer.ts:160`
- ネクストピースが1つしか表示されない
- **修正**: 次の3つのピースを表示するUIを追加。より先のピースを確認できるようにする。

### 29. ボードの背景カスタマイズのUI
**場所**: `src/renderer.ts:18`
- ボードの背景が固定されている
- **修正**: ボードの背景色やパターンをカスタマイズできるUIを追加。複数のプリセットから選択可能。

### 30. オートリプレイ設定のUI
**場所**: `新規実装`
- オートリプレイ設定がUIから変更できない
- **修正**: オートリプレイ機能の有効/無効を設定できるUIを追加。

### 31. テーマカスタマイズ機能
**場所**: `新規実装`
- ゲームのテーマが固定されている
- **修正**: ダークモード、ライトモード、カスタムカラーテーマを選択できる機能を追加。

### 32. フォントサイズの調整機能
**場所**: `styles/main.css:1`
- フォントサイズが固定されている
- **修正**: UIのフォントサイズを調整できる機能を追加。アクセシビリティを向上。

### 33. コントラスト調整機能
**場所**: `src/renderer.ts:18`
- コントラストが固定されている
- **修正**: 画面のコントラストを調整できる機能を追加。視認性を向上。

### 34. アニメーション速度の調整
**場所**: `src/renderer.ts:1`
- アニメーション速度が固定されている
- **修正**: アニメーション速度を調整できる機能を追加。パフォーマンスと視認性のバランスを調整。

### 35. サウンドエフェクトの個別調整
**場所**: `新規実装`
- サウンドエフェクトの音量が個別に調整できない
- **修正**: 各サウンドエフェクト（ピース移動、回転、落下、ライン消去など）の音量を個別に調整できる機能を追加。

### 36. キーリピート速度の調整UI
**場所**: `src/input.ts:17`
- キーリピート速度がUIから調整できない
- **修正**: キーリピートの遅延と間隔を調整できるUIを追加。

### 37. ゲーム速度の手動調整
**場所**: `src/score.ts:89`
- ゲーム速度が自動で調整されるのみ
- **修正**: ゲーム速度を手動で調整できる機能を追加。練習モードなどで活用。

### 38. ピースの色のカスタマイズ
**場所**: `src/types.ts:40`
- ピースの色が固定されている
- **修正**: 各ピースの色をカスタマイズできる機能を追加。色覚多様性に対応。

### 39. グリッド線の表示/非表示
**場所**: `src/renderer.ts:89`
- グリッド線が常に表示される
- **修正**: グリッド線の表示/非表示を切り替えられる機能を追加。

### 40. 統計データのリセット機能
**場所**: `src/main.ts:200`
- 統計データをリセットする機能がない
- **修正**: 統計データをリセットできる機能を追加。プライバシー保護。

## 🚀 機能改善（20個）

### 41. リプレイ機能の実装
**場所**: `新規実装`
- ゲームのリプレイ機能がない
- **修正**: ゲームの操作履歴を記録し、後で再生できるリプレイ機能を実装。

### 42. マルチプレイヤーモード
**場所**: `新規実装`
- マルチプレイヤーモードがない
- **修正**: ローカルで2人対戦できるマルチプレイヤーモードを実装。

### 43. AI対戦モード
**場所**: `新規実装`
- AIと対戦できるモードがない
- **修正**: テトリスAIを実装し、プレイヤーがAIと対戦できるモードを追加。AIの難易度も設定可能。

### 44. チュートリアルモード
**場所**: `新規実装`
- 初心者向けのチュートリアルがない
- **修正**: 基本的な操作を学べるチュートリアルモードを実装。

### 45. プラクティスモード
**場所**: `新規実装`
- 練習用のモードがない
- **修正**: ピースを自由に配置して練習できるプラクティスモードを実装。

### 46. チャレンジモード
**場所**: `新規実装`
- 特定の課題に挑戦するモードがない
- **修正**: 特定の課題（例: 10ラインを最短時間で消去）に挑戦できるチャレンジモードを実装。

### 47. デイリーチャレンジ
**場所**: `新規実装`
- 毎日のチャレンジがない
- **修正**: 毎日異なる課題に挑戦できるデイリーチャレンジ機能を実装。

### 48. アチーブメントシステム
**場所**: `新規実装`
- アチーブメントシステムがない
- **修正**: 特定の条件を達成するとアチーブメントを獲得できるシステムを実装。

### 49. リーダーボード機能
**場所**: `新規実装`
- オンラインのリーダーボードがない
- **修正**: オンラインでスコアを競い合えるリーダーボード機能を実装（オプション）。

### 50. ゲームの共有機能
**場所**: `新規実装`
- ゲーム結果を共有する機能がない
- **修正**: ゲーム結果を画像やテキストで共有できる機能を実装。

### 51. カスタムピースの作成
**場所**: `新規実装`
- カスタムピースを作成する機能がない
- **修正**: ユーザーが独自のピース形状を作成できる機能を実装。

### 52. カスタムボードサイズ
**場所**: `src/types.ts:36`
- ボードサイズが固定されている
- **修正**: ボードの幅と高さをカスタマイズできる機能を実装。

### 53. 重力のカスタマイズ
**場所**: `src/game.ts:295`
- 重力が固定されている
- **修正**: 重力の強さをカスタマイズできる機能を実装。逆重力モードなども追加。

### 54. ピースの出現位置のカスタマイズ
**場所**: `src/game.ts:53`
- ピースの出現位置が固定されている
- **修正**: ピースの出現位置をカスタマイズできる機能を実装。

### 55. ロック遅延のカスタマイズ
**場所**: `src/game.ts:23`
- ロック遅延が固定されている
- **修正**: ロック遅延の時間をカスタマイズできる機能を実装。

### 56. 無限ホールドモード
**場所**: `src/game.ts:214`
- ホールドは1回のピースにつき1回のみ
- **修正**: ホールドを何度でも使用できる無限ホールドモードを実装。

### 57. 20Gモード
**場所**: `新規実装`
- 20G（最速落下）モードがない
- **修正**: ピースが最速で落下する20Gモードを実装。

### 58. クリア条件のカスタマイズ
**場所**: `新規実装`
- ゲームのクリア条件が固定されている
- **修正**: クリア条件（ライン数、スコア、時間など）をカスタマイズできる機能を実装。

### 59. ピースの出現確率の調整
**場所**: `src/pieces.ts:149`
- ピースの出現確率が均等
- **修正**: ピースの出現確率を調整できる機能を実装。

### 60. スコア計算式のカスタマイズ
**場所**: `src/score.ts:24`
- スコア計算式が固定されている
- **修正**: スコア計算式をカスタマイズできる機能を実装。

## 🐛 バグ修正（20個）

### 61. ゴーストピースの描画ずれ
**場所**: `src/renderer.ts:138`
- 特定のピースや回転状態でゴーストピースの描画位置がずれることがある
- **修正**: ゴーストピースの計算ロジックと描画ロジックを再確認し、常に正確な位置に描画されるように修正。

### 62. ピース回転時の衝突判定の不具合
**場所**: `src/pieces.ts:1`
- 特定の状況でピースが回転できない、または不適切な位置に回転する
- **修正**: SRS（Super Rotation System）の実装を確認し、全ての回転パターンで正しく動作するように修正。

### 63. ホールド機能の連続使用バグ
**場所**: `src/game.ts:214`
- 特定の条件下でホールド機能が連続で使用できてしまう
- **修正**: ホールド機能の状態管理を改善し、1回のピースにつき1回のみ使用できるように確実に制限する。

### 64. スコア表示の更新バグ
**場所**: `src/renderer.ts:240`
- 特定の条件下でスコア表示が正しく更新されない、または遅延する
- **修正**: スコア更新ロジックとUI更新ロジックを分離し、スコアが変更されたら即座にUIが更新されるようにイベント駆動型にする。

### 65. ゲームオーバー後のUIフリーズ
**場所**: `src/main.ts:82`
- ゲームオーバー後、UIの一部がフリーズしたり、ボタンが反応しなくなることがある
- **修正**: ゲームオーバー時にすべてのゲームループとタイマーを停止し、UI要素が正しくインタラクティブになるように状態を管理する。

### 66. メモリリークの継続的な改善
**場所**: `src/renderer.ts:49`
- 長時間プレイでメモリ使用量が増加する
- **修正**: 不要なイベントリスナーを削除し、WeakMapを使用してメモリ管理を改善。定期的なガベージコレクションを促進。

### 67. レベルアップ時の落下速度の不整合
**場所**: `src/score.ts:19`
- レベルアップ時に落下速度が正しく更新されない場合がある
- **修正**: レベルアップ時に落下速度を確実に更新する処理を追加。

### 68. カウントダウン中のゲーム状態
**場所**: `src/main.ts:97`
- カウントダウン中にゲームが開始されてしまう
- **修正**: カウントダウン中はゲームを開始せず、カウントダウン完了後に開始するように修正。

### 69. リスタート時のタイマーリセット
**場所**: `src/game.ts:36`
- リスタート時にタイマーが正しくリセットされない
- **修正**: リスタート時に全てのタイマーを確実にリセットする処理を追加。

### 70. ピース生成時の重複チェック
**場所**: `src/game.ts:53`
- ピース生成時に既存のブロックと重複する可能性がある
- **修正**: ピース生成時に重複チェックを追加し、重複する場合は再生成する。

### 71. スコアのオーバーフロー対策
**場所**: `src/score.ts:42`
- スコアが非常に大きくなった場合にオーバーフローする可能性がある
- **修正**: スコアの上限を設定し、オーバーフローを防ぐ。

### 72. フレームレートの低下時の動作
**場所**: `src/main.ts:334`
- フレームレートが低下した場合にゲームが不自然に動作する
- **修正**: フレームレートの低下を検出し、適切に対処する処理を追加。

### 73. キー入力の重複処理
**場所**: `src/input.ts:100`
- 同じキー入力が複数回処理されることがある
- **修正**: キー入力の重複処理を防ぐ仕組みを追加。

### 74. Canvasのリサイズ時の描画問題
**場所**: `src/renderer.ts:30`
- Canvasがリサイズされた時に描画が崩れる
- **修正**: Canvasのリサイズを検出し、適切に再描画する処理を追加。

### 75. ローカルストレージの容量制限
**場所**: `src/main.ts:200`
- ローカルストレージの容量制限に達する可能性がある
- **修正**: ローカルストレージの使用量を監視し、必要に応じて古いデータを削除する。

### 76. イベントリスナーの重複登録
**場所**: `src/input.ts:39`
- イベントリスナーが重複して登録されることがある
- **修正**: イベントリスナーの登録前に既存のリスナーを削除する処理を追加。

### 77. ゲーム状態の不整合
**場所**: `src/game.ts:19`
- ゲーム状態が不整合になることがある
- **修正**: ゲーム状態の遷移を厳密に管理し、不整合が発生しないようにする。

### 78. ピース固定時のタイミング問題
**場所**: `src/game.ts:252`
- ピース固定時のタイミングが不正確な場合がある
- **修正**: ピース固定時のタイミングを正確に管理し、不整合が発生しないようにする。

### 79. ライン消去アニメーションの同期問題
**場所**: `src/game.ts:264`
- ライン消去アニメーションとゲーム状態の同期が取れない場合がある
- **修正**: ライン消去アニメーションとゲーム状態の同期を正確に管理する。

### 80. ゴーストピース計算のパフォーマンス問題
**場所**: `src/renderer.ts:185`
- ゴーストピースの計算が頻繁に行われ、パフォーマンスに影響する
- **修正**: ゴーストピースの計算を最適化し、必要な時のみ計算するようにする。

---

**作成日**: 2024-11-23
**更新日**: 2024-11-23
**総項目数**: 80個（修正案20個、改善案20個、機能改善20個、バグ修正20個）
