# 改善点リスト 101

このドキュメントには、テトリスアプリケーションの修正案、改善案、機能改善、バグ修正をまとめています。

## 📝 修正案（5個）

### 1. ピース固定時のアニメーション追加
**場所**: `src/game.ts:243`
- ピースが固定される際に視覚的なフィードバックが限定的
- **修正**: ピース固定時にブロックが一瞬光るエフェクトを追加。固定されたブロックが点滅するアニメーションを実装

### 2. レベルアップ時の通知強化
**場所**: `src/score.ts:20`
- レベルアップ時の通知が視覚的に目立たない
- **修正**: レベルアップ時に画面中央に大きな通知バナーを表示し、3秒後に自動で消える。音響フィードバックも追加

### 3. ゲームオーバー時のアニメーション
**場所**: `src/main.ts:114`
- ゲームオーバー時に突然画面が止まる
- **修正**: ゲームオーバー時に画面がフェードアウトし、モーダルがスムーズに表示されるアニメーションを追加

### 4. ピース落下速度の視覚的表示
**場所**: `src/renderer.ts:310`
- 現在の落下速度が数値で表示されていない
- **修正**: 落下間隔（ms）を数値で表示するインジケーターを追加。レベルと連動してリアルタイムに更新

### 5. ホールドピースの視覚的強調
**場所**: `src/renderer.ts:180`
- ホールド中のピースが目立たない
- **修正**: ホールドピースの周りにアニメーションする枠線を追加。ホールド可能/不可能の状態を色で区別

## 💡 改善案（5個）

### 6. ゲーム設定の保存と読み込み
**場所**: `新規実装`
- ゲーム設定が保存されない
- **修正**: 音量、キー配置、描画品質などの設定をlocalStorageに保存し、次回起動時に自動で読み込む機能を実装

### 7. カスタムコントロール設定
**場所**: `src/input.ts:52`
- キー配置が固定されている
- **修正**: 設定画面で各操作に割り当てるキーをカスタマイズできる機能を追加。設定はlocalStorageに保存

### 8. ゲーム履歴の詳細表示
**場所**: `src/main.ts:200`
- 過去のゲーム結果の詳細が表示されない
- **修正**: 各ゲームの詳細（スコア、レベル、ライン数、プレイ時間、日時）を表示する履歴画面を追加

### 9. パフォーマンス統計の表示
**場所**: `src/main.ts:150`
- パフォーマンスの詳細統計がない
- **修正**: 平均FPS、最低FPS、フレームドロップ回数などのパフォーマンス統計を表示する機能を追加

### 10. エクスポート/インポート機能
**場所**: `新規実装`
- データのバックアップ機能がない
- **修正**: 統計データとランキングをJSON形式でエクスポート/インポートできる機能を実装

## 🚀 機能改善（5個）

### 11. 難易度選択機能
**場所**: `src/game.ts:1`
- 難易度が固定されている
- **修正**: ゲーム開始前に難易度を選択できる機能を追加（イージー、ノーマル、ハード、エキスパート）。難易度に応じて落下速度を調整

### 12. カスタムゲームモード
**場所**: `src/game.ts:1`
- ゲームモードが1種類のみ
- **修正**: スプリント（40ライン）、マラソン（200ライン）、ウルトラ（無制限）などのゲームモードを追加

### 13. ピースのプレビュー拡張
**場所**: `src/renderer.ts:160`
- ネクストピースが1つしか表示されない
- **修正**: 次の3つのピースを表示する機能を追加。より先のピースを確認できるようにする

### 14. ボードの背景カスタマイズ
**場所**: `src/renderer.ts:18`
- ボードの背景が固定されている
- **修正**: ボードの背景色やパターンをカスタマイズできる機能を追加。複数のプリセットから選択可能

### 15. オートリプレイ機能
**場所**: `新規実装`
- ゲームオーバー後に自動でリプレイできない
- **修正**: ゲームオーバー後に自動でリスタートする機能を追加。設定で有効/無効を切り替え可能

## 🐛 バグ修正（5個）

### 16. カウントダウン中の操作問題
**場所**: `src/main.ts:71`
- カウントダウン中にキー入力が受け付けられる
- **修正**: カウントダウン中は入力を受け付けないようにする。カウントダウン完了後にゲームを開始

### 17. リスタート時の状態リセット問題
**場所**: `src/game.ts:36`
- リスタート時に一部の状態が正しくリセットされない
- **修正**: `start`メソッドで全ての状態を確実にリセットする処理を追加。タイマー、フラグ、変数を全て初期化

### 18. メモリリークの継続的な改善
**場所**: `src/renderer.ts:49`
- 長時間プレイでメモリ使用量が増加する
- **修正**: 不要なイベントリスナーを削除し、WeakMapを使用してメモリ管理を改善。定期的なガベージコレクションを促進

### 19. ランキングの重複登録問題
**場所**: `src/main.ts:250`
- 同じスコアが複数回ランキングに登録される可能性がある
- **修正**: ランキング登録時に重複チェックを追加。同じスコアの場合は最新のもののみを保持

### 20. 統計データの整合性問題
**場所**: `src/main.ts:200`
- 統計データが正しく更新されない場合がある
- **修正**: 統計データの更新処理を改善し、データの整合性を保証する。エラーハンドリングも追加

---

**作成日**: 2024-11-23
**更新日**: 2024-11-23
**総項目数**: 20個（修正案5個、改善案5個、機能改善5個、バグ修正5個）
